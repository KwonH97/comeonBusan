<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>맛집 목록</title>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<style>
    body.food {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
    }

    h1.food {
        text-align: center;
        margin: 20px 0;
    }

    #container-food {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto; /* 가운데 정렬 */
    }

    .foodTour-item {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #fff;
    }

    .foodTour-title {
        font-weight: bold;
        margin: 10px 0;
    }

    .foodTour-thumbnail {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        max-height: 150px; /* 사진 전체 크기 줄이기 */
    }

    .pagination-food {
        text-align: center;
        margin: 20px 0;
        display: flex;
        justify-content: center;
    }

    .pagination-food button {
        margin: 0 5px;
        padding: 10px 20px;
        border: none;
        background-color: white;
        color: #007bff;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }

    .pagination-food button:disabled {
        background-color: #ccc;
        color: #666;
        cursor: not-allowed;
    }

    .pagination-food button:hover:not(:disabled) {
        background-color: #e6f0ff;
    }

    .pagination-food button.current {
        border: 2px solid #007bff;
        color: #007bff;
        font-weight: bold;
        cursor: default;
    }
</style>
</head>
<body class="food">
    <header>
        <th:block th:insert="~{/fragments/header2.html}"></th:block>
    </header>

<h1 class="food">맛집 목록</h1>
<hr>

<div id="container-food"></div>
<div class="pagination-food"></div>
<footer>
    <th:block th:insert="~{/fragments/footer.html}"></th:block>
</footer>

<script>
    $(document).ready(function(){
        const itemsPerPage = 12;
        let currentPage = 1;
        let currentGroup = 0;
        const pagesPerGroup = 10;
        let foodData = [];

        $.ajax({
            url: "http://localhost:9002/kibTest/food",
            method: "GET",
            success: function(response){
                foodData = response;
                renderPage(currentPage);
                renderPagination(foodData.length, itemsPerPage);
            },
            error: function(error){
                console.log("Error: " + error); 
            }
        });

        function renderPage(page) {
            $('#container-food').empty();
            
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const items = foodData.slice(start, end);
            
            items.forEach(item => {
                const thumbnailSrc = (item.main_img_thumb && item.main_img_thumb !== 'null') ? item.main_img_thumb : 'http://localhost:9002/uploads/restIcon.png';
                const foodItem = `
                    <div class="foodTour-item">
                        <a href="/foodDetail?type=food&uc_seq=${item.uc_SEQ}">
                            <img class="foodTour-thumbnail" src="${thumbnailSrc}" alt="${item.maintitle}">
                        </a>
                        <div class="foodTour-title">${item.title}</div>
                    </div>
                `;
                $('#container-food').append(foodItem);
            });
        }

        function renderPagination(totalItems, itemsPerPage) {
            $('.pagination-food').empty();
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const totalGroups = Math.ceil(totalPages / pagesPerGroup);
            const currentGroup = Math.floor((currentPage - 1) / pagesPerGroup);
            const startPage = currentGroup * pagesPerGroup + 1;
            const endPage = Math.min(startPage + pagesPerGroup - 1, totalPages);

            if (currentPage > 1) {
                $('.pagination-food').append(`<button onclick="changePage(1)"><<</button>`);
            }

            if (currentGroup > 0) {
                $('.pagination-food').append(`<button onclick="changeGroup(${currentGroup - 1})"><</button>`);
            }

            for (let i = startPage; i <= endPage; i++) {
                $('.pagination-food').append(`<button onclick="changePage(${i})" class="${i === currentPage ? 'current' : ''}">${i}</button>`);
            }

            if (currentGroup < totalGroups - 1) {
                $('.pagination-food').append(`<button onclick="changeGroup(${currentGroup + 1})">></button>`);
            }

            if (currentPage < totalPages) {
                $('.pagination-food').append(`<button onclick="changePage(${totalPages})">>></button>`);
            }
        }

        window.changePage = function(page){
            if(page < 1 || page > Math.ceil(foodData.length / itemsPerPage)) return;
            currentPage = page;
            renderPage(currentPage);
            renderPagination(foodData.length, itemsPerPage);
        }

        window.changeGroup = function(group) {
            currentGroup = group;
            currentPage = currentGroup * pagesPerGroup + 1;
            renderPage(currentPage);
            renderPagination(foodData.length, itemsPerPage);
        }
    });
</script>
</body>
</html>
