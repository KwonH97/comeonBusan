<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Blog Reviews</title>
<script src="/js/common.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
.blog-review {
    border: 1px solid #ddd;
    padding: 10px;
    margin: 10px 0;
    cursor: pointer;
}
</style>
</head>
<body>
    <header>
        <th:block th:insert="~{/fragments/header2.html}"></th:block>
    </header>
    <div id="reviewContainer"></div>
    <button id="loadMoreButton">더보기</button>
</body>

<script>
    let currentPage = 1;
    const pageSize = 10;

    function loadReviews(page) {
        const urlParams = new URLSearchParams(window.location.search);
        const lid = urlParams.get('lid');

        if (lid) {
            $.ajax({
                url: `http://localhost:9002/blog`,
                type: 'GET',
                data: { lid: lid, page: page, size: pageSize },
                success: function(response) {
                    const blogData = JSON.parse(response.result);
                    if (blogData.items && blogData.items.length > 0) {
                        blogData.items.forEach(function(item) {
                            const blogLink = item.link;
                            const blogTitle = item.title;
                            const blogDescription = item.description;
                            $('#reviewContainer').append(`
                                <div class="blog-review" onclick="window.open('${blogLink}', '_blank')">
                                    <h4>${blogTitle}</h4>
                                    <p>${blogDescription}</p>
                                </div>
                            `);
                        });
                        if (blogData.items.length < pageSize) {
                            // If less than pageSize items are returned, hide the button
                            $('#loadMoreButton').hide();
                        }
                    } else {
                        $('#loadMoreButton').hide();
                        if (page === 1) {
                            $('#reviewContainer').append('<p>No reviews found.</p>');
                        }
                    }
                },
                error: function(error) {
                    console.error('Error fetching blog data:', error);
                    alert('블로그 데이터를 가져오는 중 오류가 발생했습니다.');
                }
            });
        } else {
            $('#reviewContainer').append('<p>유효한 숙박업소 ID가 제공되지 않았습니다.</p>');
        }
    }

    $(document).ready(function() {
        loadReviews(currentPage);

        $('#loadMoreButton').click(function() {
            currentPage++;
            loadReviews(currentPage);
        });
    });
</script>
</html>
