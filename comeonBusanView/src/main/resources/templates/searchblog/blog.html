<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Blog Reviews</title>
<script src="/js/common.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
/* 네이버 블로그 스타일 CSS */
body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
}

.container {
    padding: 80px 300px;
    text-align: center; /* 중앙 정렬 */
    position: relative; /* 컨테이너를 기준으로 절대 위치를 설정하기 위해 필요 */
}

#font {
    font-size: 50px; /* 적절한 글씨 크기 */
    font-weight: bold; /* 글씨 두껍게 */
    margin: 20px 0; /* 위아래 적당한 여백 */
}

.blog-review {
    border: 1px solid #e1e1e1;
    padding: 15px;
    margin: 15px 0;
    transition: background-color 0.3s ease;
    text-align: left; /* 리뷰는 왼쪽 정렬 */
}

.blog-review:hover {
    background-color: gray;
}

.blog-review h4 {
    margin: 0;
    font-size: 18px;
    color: #333;
}

.blog-review p {
    margin: 5px 0 0;
    font-size: 14px;
    color: #666;
}

#loadMoreButton {
    display: inline-block;
    padding: 8px 16px;
    font-size: 14px;
    color: #fff;
    background-color: skyblue;
    border: none;
    cursor: pointer;
    text-align: center;
    margin-top: 20px;
    transition: background-color 0.3s ease;
    position: absolute;
    right: 340px;
    bottom: 20px;
}

#loadMoreButton:hover {
    background-color: red;
}
</style>
</head>
<body>
    <header>
        <th:block th:insert="~{/fragments/header2.html}"></th:block>
    </header>
    <div class="container">
        <div id="font">블로그 리뷰</div>
        <div id="reviewContainer"></div>
        <button id="loadMoreButton">더보기</button>
    </div>
</body>
<footer>
    <th:block th:insert="~{/fragments/footer.html}"></th:block>
</footer>
<script>
    let currentPage = 1;
    const pageSize = 10;

    function loadReviews(page) {
        const urlParams = new URLSearchParams(window.location.search);
        const type = urlParams.get('type');
        const uc_seq = urlParams.get('uc_seq');
        const lid = urlParams.get('lid');
        let url = '';

        if (type === 'lodgment') {
            url = 'http://localhost:9002/blog/lodgment';
        } else if (type === 'tour') {
            url = 'http://localhost:9002/blog/tour';
        } else if (type === 'festival') {
            url = 'http://localhost:9002/blog/festival';
        } else if (type === 'food') {
            url = 'http://localhost:9002/blog/food';
        }

        $.ajax({
            url: url,
            type: 'GET',
            data: { uc_seq: uc_seq, lid: lid, page: page, size: pageSize },
            success: function(response) {
                console.log(response); // 응답 데이터 확인
                if (response.result) {
                    const blogData = JSON.parse(response.result);
                    if (blogData.items && blogData.items.length > 0) {
                        blogData.items.forEach(function(item) {
                            const blogLink = item.link;
                            const blogTitle = item.title;
                            const blogDescription = item.description;
                            $('#reviewContainer').append(`
                                <div class="blog-review" onclick="window.open('${blogLink}', '_blank')">
                                    <div>
                                        <h4>${blogTitle}</h4>
                                        <p>${blogDescription}</p>
                                    </div>
                                </div>
                            `);
                        });
                        if (blogData.items.length < pageSize) {
                            $('#loadMoreButton').hide();
                        }
                    } else {
                        $('#loadMoreButton').hide();
                        if (page === 1) {
                            $('#reviewContainer').append('<p>No reviews found.</p>');
                        }
                    }
                } else {
                    console.error('Response result is undefined:', response);
                    alert('블로그 데이터를 가져오는 중 오류가 발생했습니다.');
                }
            },
            error: function(error) {
                console.error('Error fetching blog data:', error);
                alert('블로그 데이터를 가져오는 중 오류가 발생했습니다.');
            }
        });
    }

    $(document).ready(function() {
        loadReviews(currentPage);

        $('#loadMoreButton').click(function() {
            currentPage++;
            loadReviews(currentPage);
        });
    });
</script>
</html>
