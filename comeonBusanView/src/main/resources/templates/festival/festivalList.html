<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>부산 축제</title>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    
    h1 {
        text-align: center;
        margin-top: 20px;
    }
    
    #container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto; /* 가운데 정렬 */
    }
    
    .festival-item {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    .festival-item img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        max-height: 150px; /* 사진 전체 크기 줄이기 */
    }
    
    .pagination {
        text-align: center;
        margin: 20px 0;
        display: flex;
        justify-content: center;
    }

    .pagination button {
        margin: 0 5px;
        padding: 10px 20px;
        border: none;
        background-color: white;
        color: #007bff;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }

    .pagination button:disabled {
        background-color: #ccc;
        color: #666;
        cursor: not-allowed;
    }

    .pagination button:hover:not(:disabled) {
        background-color: #e6f0ff;
    }

    .pagination button.current {
        border: 2px solid #007bff;
        color: #007bff;
        font-weight: bold;
        cursor: default;
    }
</style>
</head>
<body>
<header>
    <th:block th:insert="~{/fragments/header2.html}"></th:block>
</header>

<h1>부산 축제</h1>

<button class="hiddenButton" style="display: none;" onclick="goAddPage()">등록하기</button>

<div id="container"></div>
<div class="pagination"></div>

<script>
    $(document).ready(function(){
        const itemsPerPage = 12;
        let currentPage = 1;
        let festivalData = [];

        $.ajax({
            url: "http://localhost:9002/khj/festival",
            type: 'GET',
            success: function(response){
                festivalData = response;
                renderPage(currentPage);
                renderPagination(festivalData.length, itemsPerPage);
            },
            error: function(xhr, status, error){
                console.error("Error: " + error);
            }
        });

        var authValue = localStorage.getItem("Authorization");
        if (authValue != null) {
            $(".hiddenButton").css("display", "block");
        }

        function renderPage(page){
            $('#container').empty();
            
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const items = festivalData.slice(start, end);
            
            items.forEach(item => {
                const festivalItem = `
                    <div class="festival-item">
                        <a href="/festivalDetail?type=festival&uc_seq=${item.ucSeq}">
                            <img class="festival-thumbnail" src="${item.mainImgThumb}" alt="${item.title}">
                        </a>
                        <div class="tour-title">${item.title}</div>
                    </div>
                `;
                
                $('#container').append(festivalItem);
            });
        }

        function renderPagination(totalItems, itemsPerPage) {
            $('.pagination').empty();
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const currentGroup = Math.ceil(currentPage / 10);

            if (currentGroup > 1) {
                const firstButton = `<button onclick="changePage(1)">&laquo;&laquo;</button>`;
                $('.pagination').append(firstButton);

                const prevGroupButton = `<button onclick="changePage(${(currentGroup - 1) * 10})">&laquo;</button>`;
                $('.pagination').append(prevGroupButton);
            }

            const startPage = (currentGroup - 1) * 10 + 1;
            const endPage = Math.min(startPage + 9, totalPages);

            for(let i = startPage; i <= endPage; i++){
                const pageButton = `<button onclick="changePage(${i})" class="${i === currentPage ? 'current' : ''}">${i}</button>`;
                $('.pagination').append(pageButton);
            }

            if (currentGroup * 10 < totalPages) {
                const nextGroupButton = `<button onclick="changePage(${currentGroup * 10 + 1})">&raquo;</button>`;
                $('.pagination').append(nextGroupButton);

                const lastButton = `<button onclick="changePage(${totalPages})">&raquo;&raquo;</button>`;
                $('.pagination').append(lastButton);
            }
        }

        window.changePage = function(page){
            if(page < 1 || page > Math.ceil(festivalData.length / itemsPerPage)) return;
            currentPage = page;
            renderPage(currentPage);
            renderPagination(festivalData.length, itemsPerPage);
        }
    });

    function goAddPage(){
        window.location.href="/festivalAdd";
    }
</script>

<footer>
    <th:block th:insert="~{/fragments/footer.html}"></th:block>
</footer>

</body>
</html>
