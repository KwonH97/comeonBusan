<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>부산 관광지</title>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
    }

    h1 {
        text-align: center;
        margin: 20px 0;
    }

    #container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto; /* 가운데 정렬 */
    }

    .tour-item {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #fff;
    }

    .tour-title {
        font-weight: bold;
        margin: 10px 0;
    }

    .tour-thumbnail {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        max-height: 150px; /* 사진 전체 크기 줄이기 */
    }

    .pagination {
        text-align: center;
        margin: 20px 0;
        display: flex;
        justify-content: center;
    }

    .pagination button {
        margin: 0 5px;
        padding: 10px 20px;
        border: none;
        background-color: white;
        color: #007bff;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }

    .pagination button:disabled {
        background-color: #ccc;
        color: #666;
        cursor: not-allowed;
    }

    .pagination button:hover:not(:disabled) {
        background-color: #e6f0ff;
    }

    .pagination button.current {
        border: 2px solid #007bff;
        color: #007bff;
        font-weight: bold;
        cursor: default;
    }
</style>
</head>
<body>
<header>
    <th:block th:insert="~{/fragments/header2.html}"></th:block>
</header>

<h1>부산 관광지</h1>
<button class="hiddenButton" onclick="addTour()" style="display: none;">관광지추가</button>
<hr>
<div id="container"></div>
<div class="pagination"></div>
  <footer>
    <th:block th:insert="~{/fragments/footer.html}"></th:block>
  </footer>
<script>
    $(document).ready(function(){
        const itemsPerPage = 12;
        let currentPage = 1;
        let tourData = [];

        $.ajax({
            url: "http://localhost:9002/kibTest/tourList",
            type: 'GET',
            success: function(response) {
                tourData = response;
                renderPage(currentPage);
                renderPagination(tourData.length, itemsPerPage);
            },
            error: function(xhr, status, error) {
                console.error("Error: " + error);
            }
        });

        function renderPage(page) {
            $('#container').empty();

            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const items = tourData.slice(start, end);

            items.forEach(item => {
                const tourItem = `
                    <div class="tour-item">
                        <a href="/tourDetail?uc_seq=${item.uc_seq}">
                            <img class="tour-thumbnail" src="${item.main_img_thumb}" alt="${item.maintitle}">
                        </a>
                        <div class="tour-title">${item.title}</div>
                    </div>
                `;
                $('#container').append(tourItem);
            });
        }

        var authValue = localStorage.getItem("Authorization");
        if (authValue != null) {
            $(".hiddenButton").css("display", "block");
        }
        
        function renderPagination(totalItems, itemsPerPage) {
            $('.pagination').empty();
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            const currentGroup = Math.ceil(currentPage / 10);

            if (currentPage > 1) {
                const firstButton = `<button onclick="changePage(1)"><<</button>`;
                $('.pagination').append(firstButton);
            }

            if (currentGroup > 1) {
                const prevButton = `<button onclick="changePage(${(currentGroup - 1) * 10})"><</button>`;
                $('.pagination').append(prevButton);
            }

            const startPage = (currentGroup - 1) * 10 + 1;
            const endPage = Math.min(startPage + 9, totalPages);

            for(let i = startPage; i <= endPage; i++){
                const pageButton = `<button onclick="changePage(${i})" class="${i === currentPage ? 'current' : ''}">${i}</button>`;
                $('.pagination').append(pageButton);
            }

            if (currentGroup * 10 < totalPages) {
                const nextButton = `<button onclick="changePage(${currentGroup * 10 + 1})">></button>`;
                $('.pagination').append(nextButton);
            }

            if (currentPage < totalPages) {
                const lastButton = `<button onclick="changePage(${totalPages})">>></button>`;
                $('.pagination').append(lastButton);
            }
        }

        window.changePage = function(page){
            if(page < 1 || page > Math.ceil(tourData.length / itemsPerPage)) return;
            currentPage = page;
            renderPage(currentPage);
            renderPagination(tourData.length, itemsPerPage);
        }
        
    });
    
    function addTour(){
    	window.location.href="/regi_tour";
    }
</script>
</body>
</html>
