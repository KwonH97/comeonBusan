<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Busan Tour Planner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #planner {
            margin: 20px;
        }
        #result {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .controls {
            background-color: #fff;
            border-radius: 2px;
            border: 1px solid transparent;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
            font-family: Roboto;
            font-size: 15px;
            font-weight: 300;
            height: 40px;
            margin-left: 12px;
            margin-top: 10px;
            outline: none;
            padding: 0 11px 0 13px;
            text-overflow: ellipsis;
            width: 400px;
        }

        #generate-button {
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            font-family: Roboto;
            font-size: 15px;
            font-weight: 300;
            height: 40px;
            margin-left: 12px;
            margin-top: 10px;
            outline: none;
            padding: 0 11px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="planner">
        <h1>부산 여행 AI 맞춤 일정</h1>
        <label for="start-date">여행 시작 날짜:</label>
        <input type="date" id="start-date" class="controls"><br><br>

        <label for="end-date">여행 종료 날짜:</label>
        <input type="date" id="end-date" class="controls"><br><br>

        <label for="travel-type">여행 형태:</label>
        <select id="travel-type" class="controls">
            <option value="activity">액티비티</option>
            <option value="history">역사</option>
            <option value="food">맛집</option>
        </select><br><br>

        <label for="must-see">필수 관광지 (쉼표로 구분):</label>
        <input type="text" id="must-see" class="controls"><br><br>

        <button id="generate-button">추천 여행 일정 생성</button>
    </div>

    <div id="result"></div>

    <script>
        async function fetchWeatherData() {
            const apiKey = '07ad361c368f829e92fb66148a3a35dc';
            const cityName = 'Busan';
            const url = `http://api.openweathermap.org/data/2.5/forecast?q=${cityName}&appid=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.list.map(item => ({
                date: item.dt_txt.split(' ')[0],
                weather: item.weather[0].description,
                temp: item.main.temp
            }));
        }

        async function fetchOpenAI(prompt) {
            const apiKey = ''; // 여기에 OpenAI API 키를 입력하세요
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{"role": "user", "content": prompt}]
                })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        document.getElementById('generate-button').addEventListener('click', async () => {
            const startDate = new Date(document.getElementById('start-date').value);
            const endDate = new Date(document.getElementById('end-date').value);
            const travelType = document.getElementById('travel-type').value;
            const mustSee = document.getElementById('must-see').value.split(',').map(item => item.trim());

            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

            const weatherData = await fetchWeatherData();
            const weatherSummary = weatherData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= endDate;
            }).map(item => `Date: ${item.date}, Weather: ${item.weather}, Temperature: ${item.temp}`).join('\n');

            const prompt = `다음은 부산 여행 일정 계획에 필요한 정보입니다.
            - 여행 시작 날짜: ${startDate.toISOString().split('T')[0]}
            - 여행 종료 날짜: ${endDate.toISOString().split('T')[0]}
            - 여행 형태: ${travelType}
            - 필수 관광지: ${mustSee.join(', ')}
            - 날씨 요약: ${weatherSummary}

            위 정보를 바탕으로 매일 추천 시간과 일정을 만들어 주세요. 날씨도 같이 알려주세요. 추천할 때는 정확한 상호명과 지역명,이름으로 추천해주세요`;

            try {
                const itinerary = await fetchOpenAI(prompt);
                document.getElementById('result').innerText = itinerary;
            } catch (error) {
                document.getElementById('result').innerText = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>

