<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Festival Data Fetcher</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>부산 축제 정보</h1>
    <button id="fetchData">데이터 가져오기</button>
    <pre id="result"></pre>

    <script>
        $(document).ready(function() {
            $('#fetchData').click(function() {
                 $.ajax({
                    url: 'http://apis.data.go.kr/B551011/KorService1/searchStay1?serviceKey=sCVR8i55Be+0NJN/ppE+ueXJETgq4dOQK69iVMxaOqaPJRzNhY8lcSEuIxVxNHphEOJQLznqIjoobuErnBQT3g==numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest&arrange=A&listYN=Y',
                    type: 'GET',
                    success: function(response) {
                        // 응답 데이터를 콘솔에 출력하여 확인합니다.
                        console.log(response);

                        // XML 데이터를 보기 좋게 출력
                        const xmlString = new XMLSerializer().serializeToString(response);
                        $('#result').text(formatXml(xmlString));
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', status, error);
                        $('#result').text('데이터를 가져오는 중 오류가 발생했습니다.');
                    }
                });
            });

            function formatXml(xml) {
                const PADDING = ' '.repeat(2); // XML 포맷팅을 위한 패딩 설정
                const reg = /(>)(<)(\/*)/g;
                let pad = 0;
                return xml.replace(reg, '$1\r\n$2$3').split('\r\n').map((node, index) => {
                    let indent = 0;
                    if (node.match(/.+<\/\w[^>]*>$/)) {
                        indent = 0;
                    } else if (node.match(/^<\/\w/) && pad > 0) {
                        pad -= 1;
                    } else if (node.match(/^<\w[^>]*[^\/]>.*$/)) {
                        indent = 1;
                    } else {
                        indent = 0;
                    }

                    pad += indent;
                    return PADDING.repeat(pad - indent) + node;
                }).join('\r\n');
            }
        });
    </script>
</body>
</html>
